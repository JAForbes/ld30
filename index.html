<link rel='stylesheet' href='css/style.css'>
<center>
	<canvas id='can'></canvas>
</center>
<script src='lib/underscore.js'></script>
<script src='lib/underscore_mixins.js'></script>
<script src='lib/e.js'></script>
<script src='lib/jquery.js'></script>
<script src='lib/frame.js'></script>
<script>

function now(){
    return new Date().getTime()
}
</script>
<script>

gameID = E({
	Canvas: { el: can, width: 1, height: 1, con: can.getContext('2d') },
	Mouse: { x: can.width/2, y: can.height/2, },
	Paused: { paused: false },
	Screen: { width: 0, height: 0},
})

home = E({
    Position: {x: can.width/2, y:can.height/2},
    Velocity: {x: 0,y:0},
    LockPosition: {position: 'center'},

    Strength: { strength: 150 },
    
    //Frame: {scale: 1, playspeed: 1/10, frame: new Frame().reset(resource_test) },
})

spikey = E({
    GestureShoot: {},
    SpikeyStrength: { spikes: 130, randomAngle: 0, randomRadius:25 },
    Arc: { radius: 0, ratio: 0, theta: { start:0 , end: 0} },
    Strength: E('Strength',home),
    Position: E('Position',home),
    DamageOnCollision: { inCircle: true },
})

shield = E({
    GestureShoot: {},
    Arc : { radius: 0, ratio: 0, theta: { start: 0, end: 0} },
    GestureShield: { protect: spikey },
    Position: E('Position',home),
    RenderArc: {},
    Strength: { strength: 0 },
    DamageOnCollision: { inCircle: true, inArc: true },

})

fireballTemplate = {
    Position: {x:0 ,y: 0},
    Velocity: {x: 0, y:0 },
    Arc: { radius: 20, ratio: 1, theta : { start: 0 , end : 2 * Math.PI }},
    DieOnCollision: { inCircle: true, inArc: false },
    Speed: { speed: 10 },
    Strength: { strength: 5 },
    RenderArc: {},
}


function Enemy(){
    var positions = [
        {x: 100, y: 100},
        {x: can.width/2, y: 100},
        {x: can.width/2, y: can.height-100},
        {x: can.width - 100, y: 100},
        {x: 100, y: can.height - 100},
        {x: can.width - 100, y: can.height - 100},
        {x: can.width /2, y: can.height - 100},
        {x: 100 , y: can.height /2},
        {x: can.width-100, y: can.height /2},

    ]
    return {
      Position: _(positions).sample(),
      Velocity: {x:0, y: 0},
      Arc: {radius : 20, ratio: 1, theta : { start: 0 , end : 2 * Math.PI }},
      DieOnCollision: { inCircle: true, inArc: false },
      RenderArc: {},
      Strength: { strength: 50 },
      Weapon: { fireRate: 100, template: fireballTemplate, target: home, clock: 50 }

    }
}

function updateScreen(){
    var $el = $(window);
    var w = $el.width()
    var h = $el.height();
    var screen = E('Screen',gameID)
    screen.width = w;
    screen.height = h;
}

$(window).resize(updateScreen)
updateScreen()



can.onmousemove = function (e) {
	var mouse = E('Mouse',gameID);
	mouse.x = e.offsetX
    mouse.y = e.offsetY
}

can.onmousedown = function(e){
    var mouse = E('Mouse',gameID);
    mouse.down = true;
}

can.onmouseup = function(e){
    var mouse = E('Mouse',gameID);
    mouse.down = false;
}



</script>
<script src='js/systems.js'></script>
<script src='js/game.js'></script>
